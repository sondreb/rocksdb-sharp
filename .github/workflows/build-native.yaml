name: Build

on:
  push:
    branches:
      - master
      - feature/*
#  repository_dispatch:
#    types: [build]
  workflow_dispatch:

jobs:

  buildAndUnitTest:

    strategy:
      matrix:
        os: [ windows-latest, ubuntu-latest, macos-latest ]
      fail-fast: false

    runs-on: ${{ matrix.os }}

    env:
      SOLUTION_PATH: 'src/RocksDB.sln'
      BUILD_CONFIGURATION: 'Release'

    steps:

    - uses: actions/checkout@v2
      name: Checkout

    - name: Variables
      run: |
        ROCKSDBVNUM=`cat rocksdbversion`
        echo "ROCKSDBVERSION=$(cat rocksdbversion)" >> $GITHUB_ENV
      shell: bash

    - name: Variables 2
      run: |
        echo $ROCKSDBVERSION
      shell: bash

    - name: Build site assets
      working-directory: ${{ github.workspace }}
      run: ls -la
      continue-on-error: true

    - name: Display structure of files
      run: ls -R
      continue-on-error: true

    - name: Build 3
      run: |
        chmod +x ./build-rocksdb.sh
        sh ./build-rocksdb.sh
      shell: bash
      continue-on-error: true
      working-directory: ${{ github.workspace }}/build-native/

    - name: Build 6
      run: |
        chmod +x ${GITHUB_WORKSPACE}/build-native/build-rocksdb.sh
        sh ${GITHUB_WORKSPACE}/build-native/build-rocksdb.sh
      shell: bash
      continue-on-error: true

    # - name: Build
    #   run: |
    #     #chmod +x "build-rocksdb.sh"
    #     "./build-native/build-rocksdb.sh"
    #   shell: bash
    #   working-directory: "${GITHUB_WORKSPACE}"
